{"remainingRequest":"/Users/weizhibang/work/cloud_vue/node_modules/thread-loader/dist/cjs.js!/Users/weizhibang/work/cloud_vue/node_modules/babel-loader/lib/index.js!/Users/weizhibang/work/cloud_vue/node_modules/eslint-loader/index.js??ref--13-0!/Users/weizhibang/work/cloud_vue/src/store/modules/d2admin/modules/page.js","dependencies":[{"path":"/Users/weizhibang/work/cloud_vue/src/store/modules/d2admin/modules/page.js","mtime":1538206615119},{"path":"/Users/weizhibang/work/cloud_vue/node_modules/cache-loader/dist/cjs.js","mtime":1538207325695},{"path":"/Users/weizhibang/work/cloud_vue/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/weizhibang/work/cloud_vue/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/weizhibang/work/cloud_vue/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.set\";\nimport \"core-js/modules/es6.array.from\";\nimport _toConsumableArray from \"/Users/weizhibang/work/cloud_vue/node_modules/@babel/runtime/helpers/builtin/es6/toConsumableArray\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.find-index\";\nimport \"core-js/modules/es6.object.assign\";\nimport \"core-js/modules/es6.array.find\";\nimport \"core-js/modules/es6.function.name\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/weizhibang/work/cloud_vue/node_modules/@babel/runtime/helpers/builtin/es6/asyncToGenerator\";\nimport { remove, get } from 'lodash'; // 设置文件\n\nimport setting from '@/setting.js';\nexport default {\n  namespaced: true,\n  state: {\n    // 可以在多页 tab 模式下显示的页面\n    pool: [],\n    // 当前显示的多页面列表\n    opened: setting.page.opened,\n    // 当前页面\n    current: '',\n    // 需要缓存的页面 name\n    keepAlive: []\n  },\n  actions: {\n    /**\n     * @class opened\n     * @description 从持久化数据载入分页列表\n     * @param {Object} state vuex state\n     */\n    openedLoad: function openedLoad(_ref) {\n      var state = _ref.state,\n          commit = _ref.commit,\n          dispatch = _ref.dispatch;\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref2 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee(resolve) {\n          var value, valid;\n          return regeneratorRuntime.wrap(function _callee$(_context) {\n            while (1) {\n              switch (_context.prev = _context.next) {\n                case 0:\n                  _context.next = 2;\n                  return dispatch('d2admin/db/get', {\n                    dbName: 'sys',\n                    path: 'page.opened',\n                    defaultValue: setting.page.opened,\n                    user: true\n                  }, {\n                    root: true\n                  });\n\n                case 2:\n                  value = _context.sent;\n                  // 在处理函数中进行数据优化 过滤掉现在已经失效的页签或者已经改变了信息的页签\n                  // 以 name 字段为准\n                  // 如果页面过多的话可能需要优化算法\n                  // valid 有效列表 1, 1, 0, 1 => 有效, 有效, 失效, 有效\n                  valid = []; // 处理数据\n\n                  state.opened = value.map(function (opened) {\n                    // 忽略首页\n                    if (opened.name === 'index') {\n                      valid.push(1);\n                      return opened;\n                    } // 尝试在所有的支持多标签页的页面里找到 name 匹配的页面\n\n\n                    var find = state.pool.find(function (item) {\n                      return item.name === opened.name;\n                    }); // 记录有效或无效信息\n\n                    valid.push(find ? 1 : 0); // 返回合并后的数据 新的覆盖旧的\n                    // 新的数据中一般不会携带 params 和 query, 所以旧的参数会留存\n\n                    return Object.assign({}, opened, find);\n                  }).filter(function (opened, index) {\n                    return valid[index] === 1;\n                  }); // 根据 opened 数据生成缓存设置\n\n                  commit('keepAliveRefresh'); // end\n\n                  resolve();\n\n                case 7:\n                case \"end\":\n                  return _context.stop();\n              }\n            }\n          }, _callee, this);\n        }));\n\n        return function (_x) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * 将 opened 属性赋值并持久化 在这之前请先确保已经更新了 state.opened\n     * @param {Object} state vuex state\n     */\n    opend2db: function opend2db(_ref3) {\n      var state = _ref3.state,\n          dispatch = _ref3.dispatch;\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref4 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee2(resolve) {\n          return regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  // 设置数据\n                  dispatch('d2admin/db/set', {\n                    dbName: 'sys',\n                    path: 'page.opened',\n                    value: state.opened,\n                    user: true\n                  }, {\n                    root: true\n                  }); // end\n\n                  resolve();\n\n                case 2:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, this);\n        }));\n\n        return function (_x2) {\n          return _ref4.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * @class opened\n     * @description 更新页面列表上的某一项\n     * @param {Object} state vuex state\n     * @param {Object} param { index, params, query } 路由信息\n     */\n    openedUpdate: function openedUpdate(_ref5, _ref6) {\n      var state = _ref5.state,\n          commit = _ref5.commit,\n          dispatch = _ref5.dispatch;\n      var index = _ref6.index,\n          params = _ref6.params,\n          query = _ref6.query;\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref7 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee3(resolve) {\n          var page;\n          return regeneratorRuntime.wrap(function _callee3$(_context3) {\n            while (1) {\n              switch (_context3.prev = _context3.next) {\n                case 0:\n                  // 更新页面列表某一项\n                  page = state.opened[index];\n                  page.params = params || page.params;\n                  page.query = query || page.query;\n                  state.opened.splice(index, 1, page); // 增加缓存设置\n\n                  commit('keepAlivePush', page.name); // 持久化\n\n                  _context3.next = 7;\n                  return dispatch('opend2db');\n\n                case 7:\n                  // end\n                  resolve();\n\n                case 8:\n                case \"end\":\n                  return _context3.stop();\n              }\n            }\n          }, _callee3, this);\n        }));\n\n        return function (_x3) {\n          return _ref7.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * @class opened\n     * @description 新增一个 tag (打开一个页面)\n     * @param {Object} state vuex state\n     * @param {Object} param new tag info\n     */\n    add: function add(_ref8, _ref9) {\n      var state = _ref8.state,\n          commit = _ref8.commit,\n          dispatch = _ref8.dispatch;\n      var tag = _ref9.tag,\n          params = _ref9.params,\n          query = _ref9.query;\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref10 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee4(resolve) {\n          var newTag;\n          return regeneratorRuntime.wrap(function _callee4$(_context4) {\n            while (1) {\n              switch (_context4.prev = _context4.next) {\n                case 0:\n                  // 设置新的 tag 在新打开一个以前没打开过的页面时使用\n                  newTag = tag;\n                  newTag.params = params || newTag.params;\n                  newTag.query = query || newTag.query; // 添加进当前显示的页面数组\n\n                  state.opened.push(newTag); // 如果这个页面需要缓存 将其添加到缓存设置\n\n                  if (get(newTag, 'meta.requiresAuth', false)) {\n                    commit('keepAlivePush', tag.name);\n                  } // 持久化\n\n\n                  _context4.next = 7;\n                  return dispatch('opend2db');\n\n                case 7:\n                  // end\n                  resolve();\n\n                case 8:\n                case \"end\":\n                  return _context4.stop();\n              }\n            }\n          }, _callee4, this);\n        }));\n\n        return function (_x4) {\n          return _ref10.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * @class current\n     * @description 打开一个新的页面\n     * @param {Object} state vuex state\n     * @param {Object} param { name, params, query } 路由信息\n     */\n    open: function open(_ref11, _ref12) {\n      var state = _ref11.state,\n          commit = _ref11.commit,\n          dispatch = _ref11.dispatch;\n      var name = _ref12.name,\n          params = _ref12.params,\n          query = _ref12.query;\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref13 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee5(resolve) {\n          var opened, pageOpendIndex, pageOpend, page;\n          return regeneratorRuntime.wrap(function _callee5$(_context5) {\n            while (1) {\n              switch (_context5.prev = _context5.next) {\n                case 0:\n                  // 已经打开的页面\n                  opened = state.opened; // 判断此页面是否已经打开 并且记录位置\n\n                  pageOpendIndex = 0;\n                  pageOpend = opened.find(function (page, index) {\n                    var same = page.name === name;\n                    pageOpendIndex = same ? index : pageOpendIndex;\n                    return same;\n                  });\n\n                  if (!pageOpend) {\n                    _context5.next = 8;\n                    break;\n                  }\n\n                  _context5.next = 6;\n                  return dispatch('openedUpdate', {\n                    index: pageOpendIndex,\n                    params: params,\n                    query: query\n                  });\n\n                case 6:\n                  _context5.next = 12;\n                  break;\n\n                case 8:\n                  // 页面以前没有打开过\n                  page = state.pool.find(function (t) {\n                    return t.name === name;\n                  });\n\n                  if (!page) {\n                    _context5.next = 12;\n                    break;\n                  }\n\n                  _context5.next = 12;\n                  return dispatch('add', {\n                    tag: page,\n                    params: params,\n                    query: query\n                  });\n\n                case 12:\n                  commit('currentSet', name); // end\n\n                  resolve();\n\n                case 14:\n                case \"end\":\n                  return _context5.stop();\n              }\n            }\n          }, _callee5, this);\n        }));\n\n        return function (_x5) {\n          return _ref13.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * @class opened\n     * @description 关闭一个 tag (关闭一个页面)\n     * @param {Object} state vuex state\n     * @param {Object} param { tagName: 要关闭的标签名字, vm: vue }\n     */\n    close: function close(_ref14, _ref15) {\n      var state = _ref14.state,\n          commit = _ref14.commit,\n          dispatch = _ref14.dispatch;\n      var tagName = _ref15.tagName,\n          vm = _ref15.vm;\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref16 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee6(resolve) {\n          var newPage, isCurrent, len, i, index, _newPage, _newPage$name, name, _newPage$params, params, _newPage$query, query, routerObj;\n\n          return regeneratorRuntime.wrap(function _callee6$(_context6) {\n            while (1) {\n              switch (_context6.prev = _context6.next) {\n                case 0:\n                  // 下个新的页面\n                  newPage = state.opened[0];\n                  isCurrent = state.current === tagName; // 如果关闭的页面就是当前显示的页面\n\n                  if (!isCurrent) {\n                    _context6.next = 12;\n                    break;\n                  }\n\n                  // 去找一个新的页面\n                  len = state.opened.length;\n                  i = 1;\n\n                case 5:\n                  if (!(i < len)) {\n                    _context6.next = 12;\n                    break;\n                  }\n\n                  if (!(state.opened[i].name === tagName)) {\n                    _context6.next = 9;\n                    break;\n                  }\n\n                  if (i < len - 1) {\n                    newPage = state.opened[i + 1];\n                  } else {\n                    newPage = state.opened[i - 1];\n                  }\n\n                  return _context6.abrupt(\"break\", 12);\n\n                case 9:\n                  i++;\n                  _context6.next = 5;\n                  break;\n\n                case 12:\n                  // 找到这个页面在已经打开的数据里是第几个\n                  index = state.opened.findIndex(function (page) {\n                    return page.name === tagName;\n                  });\n\n                  if (index >= 0) {\n                    // 更新数据 删除关闭的页面\n                    state.opened.splice(index, 1); // 如果这个页面是缓存的页面 将其在缓存设置中删除\n\n                    commit('keepAliveRemove', tagName);\n                  } // 持久化\n\n\n                  _context6.next = 16;\n                  return dispatch('opend2db');\n\n                case 16:\n                  // 最后需要判断是否需要跳到首页\n                  if (isCurrent) {\n                    _newPage = newPage, _newPage$name = _newPage.name, name = _newPage$name === void 0 ? '' : _newPage$name, _newPage$params = _newPage.params, params = _newPage$params === void 0 ? {} : _newPage$params, _newPage$query = _newPage.query, query = _newPage$query === void 0 ? {} : _newPage$query;\n                    routerObj = {\n                      name: name,\n                      params: params,\n                      query: query\n                    };\n                    vm.$router.push(routerObj);\n                  } // end\n\n\n                  resolve();\n\n                case 18:\n                case \"end\":\n                  return _context6.stop();\n              }\n            }\n          }, _callee6, this);\n        }));\n\n        return function (_x6) {\n          return _ref16.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * @class opened\n     * @description 关闭当前标签左边的标签\n     * @param {Object} state vuex state\n     * @param {Object} param { pageSelect: 当前选中的tagName, vm: vue }\n     */\n    closeLeft: function closeLeft(_ref17) {\n      var state = _ref17.state,\n          commit = _ref17.commit,\n          dispatch = _ref17.dispatch;\n\n      var _ref18 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          pageSelect = _ref18.pageSelect,\n          vm = _ref18.vm;\n\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref19 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee7(resolve) {\n          var pageAim, currentIndex;\n          return regeneratorRuntime.wrap(function _callee7$(_context7) {\n            while (1) {\n              switch (_context7.prev = _context7.next) {\n                case 0:\n                  pageAim = pageSelect || state.current;\n                  currentIndex = 0;\n                  state.opened.forEach(function (page, index) {\n                    if (page.name === pageAim) {\n                      currentIndex = index;\n                    }\n                  });\n\n                  if (currentIndex > 0) {\n                    // 删除打开的页面 并在缓存设置中删除\n                    state.opened.splice(1, currentIndex - 1).forEach(function (_ref20) {\n                      var name = _ref20.name;\n                      return commit('keepAliveRemove', name);\n                    });\n                  }\n\n                  state.current = pageAim;\n\n                  if (vm && vm.$route.name !== pageAim) {\n                    vm.$router.push({\n                      name: pageAim\n                    });\n                  } // 持久化\n\n\n                  _context7.next = 8;\n                  return dispatch('opend2db');\n\n                case 8:\n                  // end\n                  resolve();\n\n                case 9:\n                case \"end\":\n                  return _context7.stop();\n              }\n            }\n          }, _callee7, this);\n        }));\n\n        return function (_x7) {\n          return _ref19.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * @class opened\n     * @description 关闭当前标签右边的标签\n     * @param {Object} state vuex state\n     * @param {Object} param { pageSelect: 当前选中的tagName, vm: vue }\n     */\n    closeRight: function closeRight(_ref21) {\n      var state = _ref21.state,\n          commit = _ref21.commit,\n          dispatch = _ref21.dispatch;\n\n      var _ref22 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          pageSelect = _ref22.pageSelect,\n          vm = _ref22.vm;\n\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref23 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee8(resolve) {\n          var pageAim, currentIndex;\n          return regeneratorRuntime.wrap(function _callee8$(_context8) {\n            while (1) {\n              switch (_context8.prev = _context8.next) {\n                case 0:\n                  pageAim = pageSelect || state.current;\n                  currentIndex = 0;\n                  state.opened.forEach(function (page, index) {\n                    if (page.name === pageAim) {\n                      currentIndex = index;\n                    }\n                  }); // 删除打开的页面 并在缓存设置中删除\n\n                  state.opened.splice(currentIndex + 1).forEach(function (_ref24) {\n                    var name = _ref24.name;\n                    return commit('keepAliveRemove', name);\n                  }); // 设置当前的页面\n\n                  state.current = pageAim;\n\n                  if (vm && vm.$route.name !== pageAim) {\n                    vm.$router.push({\n                      name: pageAim\n                    });\n                  } // 持久化\n\n\n                  _context8.next = 8;\n                  return dispatch('opend2db');\n\n                case 8:\n                  // end\n                  resolve();\n\n                case 9:\n                case \"end\":\n                  return _context8.stop();\n              }\n            }\n          }, _callee8, this);\n        }));\n\n        return function (_x8) {\n          return _ref23.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * @class opened\n     * @description 关闭当前激活之外的 tag\n     * @param {Object} state vuex state\n     * @param {Object} param { pageSelect: 当前选中的tagName, vm: vue }\n     */\n    closeOther: function closeOther(_ref25) {\n      var state = _ref25.state,\n          commit = _ref25.commit,\n          dispatch = _ref25.dispatch;\n\n      var _ref26 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          pageSelect = _ref26.pageSelect,\n          vm = _ref26.vm;\n\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref27 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee9(resolve) {\n          var pageAim, currentIndex;\n          return regeneratorRuntime.wrap(function _callee9$(_context9) {\n            while (1) {\n              switch (_context9.prev = _context9.next) {\n                case 0:\n                  pageAim = pageSelect || state.current;\n                  currentIndex = 0;\n                  state.opened.forEach(function (page, index) {\n                    if (page.name === pageAim) {\n                      currentIndex = index;\n                    }\n                  }); // 删除打开的页面数据 并更新缓存设置\n\n                  if (currentIndex === 0) {\n                    state.opened.splice(1).forEach(function (_ref28) {\n                      var name = _ref28.name;\n                      return commit('keepAliveRemove', name);\n                    });\n                  } else {\n                    state.opened.splice(currentIndex + 1).forEach(function (_ref29) {\n                      var name = _ref29.name;\n                      return commit('keepAliveRemove', name);\n                    });\n                    state.opened.splice(1, currentIndex - 1).forEach(function (_ref30) {\n                      var name = _ref30.name;\n                      return commit('keepAliveRemove', name);\n                    });\n                  } // 设置新的页面\n\n\n                  state.current = pageAim;\n\n                  if (vm && vm.$route.name !== pageAim) {\n                    vm.$router.push({\n                      name: pageAim\n                    });\n                  } // 持久化\n\n\n                  _context9.next = 8;\n                  return dispatch('opend2db');\n\n                case 8:\n                  // end\n                  resolve();\n\n                case 9:\n                case \"end\":\n                  return _context9.stop();\n              }\n            }\n          }, _callee9, this);\n        }));\n\n        return function (_x9) {\n          return _ref27.apply(this, arguments);\n        };\n      }());\n    },\n\n    /**\n     * @class opened\n     * @description 关闭所有 tag\n     * @param {Object} state vuex state\n     * @param {Object} vm vue\n     */\n    closeAll: function closeAll(_ref31, vm) {\n      var state = _ref31.state,\n          commit = _ref31.commit,\n          dispatch = _ref31.dispatch;\n      return new Promise(\n      /*#__PURE__*/\n      function () {\n        var _ref32 = _asyncToGenerator(\n        /*#__PURE__*/\n        regeneratorRuntime.mark(function _callee10(resolve) {\n          return regeneratorRuntime.wrap(function _callee10$(_context10) {\n            while (1) {\n              switch (_context10.prev = _context10.next) {\n                case 0:\n                  // 删除打开的页面 并在缓存设置中删除\n                  state.opened.splice(1).forEach(function (_ref33) {\n                    var name = _ref33.name;\n                    return commit('keepAliveRemove', name);\n                  }); // 持久化\n\n                  _context10.next = 3;\n                  return dispatch('opend2db');\n\n                case 3:\n                  // 关闭所有的标签页后需要判断一次现在是不是在首页\n                  if (vm.$route.name !== 'index') {\n                    vm.$router.push({\n                      name: 'index'\n                    });\n                  } // end\n\n\n                  resolve();\n\n                case 5:\n                case \"end\":\n                  return _context10.stop();\n              }\n            }\n          }, _callee10, this);\n        }));\n\n        return function (_x10) {\n          return _ref32.apply(this, arguments);\n        };\n      }());\n    }\n  },\n  mutations: {\n    /**\n     * @class keepAlive\n     * @description 从已经打开的页面记录中更新需要缓存的页面记录\n     * @param {Object} state vuex state\n     */\n    keepAliveRefresh: function keepAliveRefresh(state) {\n      state.keepAlive = state.opened.filter(function (item) {\n        if (item.meta) {\n          if (item.meta.notCache) {\n            return false;\n          }\n        }\n\n        return true;\n      }).map(function (e) {\n        return e.name;\n      });\n    },\n\n    /**\n     * @description 删除一个页面的缓存设置\n     * @param {Object} state vuex state\n     * @param {String} name name\n     */\n    keepAliveRemove: function keepAliveRemove(state, name) {\n      var list = _toConsumableArray(state.keepAlive);\n\n      remove(list, function (item) {\n        return item === name;\n      });\n      state.keepAlive = list;\n    },\n\n    /**\n     * @description 增加一个页面的缓存设置\n     * @param {Object} state vuex state\n     * @param {String} name name\n     */\n    keepAlivePush: function keepAlivePush(state, name) {\n      var keep = _toConsumableArray(state.keepAlive);\n\n      keep.push(name);\n      state.keepAlive = Array.from(new Set(keep));\n    },\n\n    /**\n     * @description 清空页面缓存设置\n     * @param {Object} state vuex state\n     */\n    keepAliveClean: function keepAliveClean(state) {\n      state.keepAlive = [];\n    },\n\n    /**\n     * @class current\n     * @description 设置当前激活的页面 name\n     * @param {Object} state vuex state\n     * @param {String} name new name\n     */\n    currentSet: function currentSet(state, name) {\n      state.current = name;\n    },\n\n    /**\n     * @class pool\n     * @description 保存 pool (候选池)\n     * @param {Object} state vuex state\n     * @param {Array} routes routes\n     */\n    init: function init(state, routes) {\n      var pool = [];\n\n      var push = function push(routes) {\n        routes.forEach(function (route) {\n          if (route.children) {\n            push(route.children);\n          } else {\n            if (!route.hidden) {\n              var meta = route.meta,\n                  name = route.name,\n                  path = route.path;\n              pool.push({\n                meta: meta,\n                name: name,\n                path: path\n              });\n            }\n          }\n        });\n      };\n\n      push(routes);\n      state.pool = pool;\n    }\n  }\n};",{"version":3,"sources":["/Users/weizhibang/work/cloud_vue/src/store/modules/d2admin/modules/page.js"],"names":["remove","get","setting","namespaced","state","pool","opened","page","current","keepAlive","actions","openedLoad","commit","dispatch","Promise","resolve","dbName","path","defaultValue","user","root","value","valid","map","name","push","find","item","Object","assign","filter","index","opend2db","openedUpdate","params","query","splice","add","tag","newTag","open","pageOpendIndex","pageOpend","same","t","close","tagName","vm","newPage","isCurrent","len","length","i","findIndex","routerObj","$router","closeLeft","pageSelect","pageAim","currentIndex","forEach","$route","closeRight","closeOther","closeAll","mutations","keepAliveRefresh","meta","notCache","e","keepAliveRemove","list","keepAlivePush","keep","Array","from","Set","keepAliveClean","currentSet","init","routes","route","children","hidden"],"mappings":"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","sourcesContent":["import { remove, get } from 'lodash'\n\n// 设置文件\nimport setting from '@/setting.js'\n\nexport default {\n  namespaced: true,\n  state: {\n    // 可以在多页 tab 模式下显示的页面\n    pool: [],\n    // 当前显示的多页面列表\n    opened: setting.page.opened,\n    // 当前页面\n    current: '',\n    // 需要缓存的页面 name\n    keepAlive: []\n  },\n  actions: {\n    /**\n     * @class opened\n     * @description 从持久化数据载入分页列表\n     * @param {Object} state vuex state\n     */\n    openedLoad ({ state, commit, dispatch }) {\n      return new Promise(async resolve => {\n        // store 赋值\n        const value = await dispatch('d2admin/db/get', {\n          dbName: 'sys',\n          path: 'page.opened',\n          defaultValue: setting.page.opened,\n          user: true\n        }, { root: true })\n        // 在处理函数中进行数据优化 过滤掉现在已经失效的页签或者已经改变了信息的页签\n        // 以 name 字段为准\n        // 如果页面过多的话可能需要优化算法\n        // valid 有效列表 1, 1, 0, 1 => 有效, 有效, 失效, 有效\n        const valid = []\n        // 处理数据\n        state.opened = value.map(opened => {\n          // 忽略首页\n          if (opened.name === 'index') {\n            valid.push(1)\n            return opened\n          }\n          // 尝试在所有的支持多标签页的页面里找到 name 匹配的页面\n          const find = state.pool.find(item => item.name === opened.name)\n          // 记录有效或无效信息\n          valid.push(find ? 1 : 0)\n          // 返回合并后的数据 新的覆盖旧的\n          // 新的数据中一般不会携带 params 和 query, 所以旧的参数会留存\n          return Object.assign({}, opened, find)\n        }).filter((opened, index) => valid[index] === 1)\n        // 根据 opened 数据生成缓存设置\n        commit('keepAliveRefresh')\n        // end\n        resolve()\n      })\n    },\n    /**\n     * 将 opened 属性赋值并持久化 在这之前请先确保已经更新了 state.opened\n     * @param {Object} state vuex state\n     */\n    opend2db ({ state, dispatch }) {\n      return new Promise(async resolve => {\n        // 设置数据\n        dispatch('d2admin/db/set', {\n          dbName: 'sys',\n          path: 'page.opened',\n          value: state.opened,\n          user: true\n        }, { root: true })\n        // end\n        resolve()\n      })\n    },\n    /**\n     * @class opened\n     * @description 更新页面列表上的某一项\n     * @param {Object} state vuex state\n     * @param {Object} param { index, params, query } 路由信息\n     */\n    openedUpdate ({ state, commit, dispatch }, { index, params, query }) {\n      return new Promise(async resolve => {\n        // 更新页面列表某一项\n        let page = state.opened[index]\n        page.params = params || page.params\n        page.query = query || page.query\n        state.opened.splice(index, 1, page)\n        // 增加缓存设置\n        commit('keepAlivePush', page.name)\n        // 持久化\n        await dispatch('opend2db')\n        // end\n        resolve()\n      })\n    },\n    /**\n     * @class opened\n     * @description 新增一个 tag (打开一个页面)\n     * @param {Object} state vuex state\n     * @param {Object} param new tag info\n     */\n    add ({ state, commit, dispatch }, { tag, params, query }) {\n      return new Promise(async resolve => {\n        // 设置新的 tag 在新打开一个以前没打开过的页面时使用\n        let newTag = tag\n        newTag.params = params || newTag.params\n        newTag.query = query || newTag.query\n        // 添加进当前显示的页面数组\n        state.opened.push(newTag)\n        // 如果这个页面需要缓存 将其添加到缓存设置\n        if (get(newTag, 'meta.requiresAuth', false)) {\n          commit('keepAlivePush', tag.name)\n        }\n        // 持久化\n        await dispatch('opend2db')\n        // end\n        resolve()\n      })\n    },\n    /**\n     * @class current\n     * @description 打开一个新的页面\n     * @param {Object} state vuex state\n     * @param {Object} param { name, params, query } 路由信息\n     */\n    open ({ state, commit, dispatch }, { name, params, query }) {\n      return new Promise(async resolve => {\n        // 已经打开的页面\n        let opened = state.opened\n        // 判断此页面是否已经打开 并且记录位置\n        let pageOpendIndex = 0\n        const pageOpend = opened.find((page, index) => {\n          const same = page.name === name\n          pageOpendIndex = same ? index : pageOpendIndex\n          return same\n        })\n        if (pageOpend) {\n          // 页面以前打开过 但是新的页面可能 name 一样，参数不一样\n          await dispatch('openedUpdate', {\n            index: pageOpendIndex,\n            params,\n            query\n          })\n        } else {\n          // 页面以前没有打开过\n          let page = state.pool.find(t => t.name === name)\n          if (page) {\n            await dispatch('add', {\n              tag: page,\n              params,\n              query\n            })\n          }\n        }\n        commit('currentSet', name)\n        // end\n        resolve()\n      })\n    },\n    /**\n     * @class opened\n     * @description 关闭一个 tag (关闭一个页面)\n     * @param {Object} state vuex state\n     * @param {Object} param { tagName: 要关闭的标签名字, vm: vue }\n     */\n    close ({ state, commit, dispatch }, { tagName, vm }) {\n      return new Promise(async resolve => {\n        // 下个新的页面\n        let newPage = state.opened[0]\n        const isCurrent = state.current === tagName\n        // 如果关闭的页面就是当前显示的页面\n        if (isCurrent) {\n          // 去找一个新的页面\n          let len = state.opened.length\n          for (let i = 1; i < len; i++) {\n            if (state.opened[i].name === tagName) {\n              if (i < len - 1) {\n                newPage = state.opened[i + 1]\n              } else {\n                newPage = state.opened[i - 1]\n              }\n              break\n            }\n          }\n        }\n        // 找到这个页面在已经打开的数据里是第几个\n        const index = state.opened.findIndex(page => page.name === tagName)\n        if (index >= 0) {\n          // 更新数据 删除关闭的页面\n          state.opened.splice(index, 1)\n          // 如果这个页面是缓存的页面 将其在缓存设置中删除\n          commit('keepAliveRemove', tagName)\n        }\n        // 持久化\n        await dispatch('opend2db')\n        // 最后需要判断是否需要跳到首页\n        if (isCurrent) {\n          const { name = '', params = {}, query = {} } = newPage\n          let routerObj = {\n            name,\n            params,\n            query\n          }\n          vm.$router.push(routerObj)\n        }\n        // end\n        resolve()\n      })\n    },\n    /**\n     * @class opened\n     * @description 关闭当前标签左边的标签\n     * @param {Object} state vuex state\n     * @param {Object} param { pageSelect: 当前选中的tagName, vm: vue }\n     */\n    closeLeft ({ state, commit, dispatch }, { pageSelect, vm } = {}) {\n      return new Promise(async resolve => {\n        const pageAim = pageSelect || state.current\n        let currentIndex = 0\n        state.opened.forEach((page, index) => {\n          if (page.name === pageAim) {\n            currentIndex = index\n          }\n        })\n        if (currentIndex > 0) {\n          // 删除打开的页面 并在缓存设置中删除\n          state.opened.splice(1, currentIndex - 1).forEach(({ name }) => commit('keepAliveRemove', name))\n        }\n        state.current = pageAim\n        if (vm && vm.$route.name !== pageAim) {\n          vm.$router.push({\n            name: pageAim\n          })\n        }\n        // 持久化\n        await dispatch('opend2db')\n        // end\n        resolve()\n      })\n    },\n    /**\n     * @class opened\n     * @description 关闭当前标签右边的标签\n     * @param {Object} state vuex state\n     * @param {Object} param { pageSelect: 当前选中的tagName, vm: vue }\n     */\n    closeRight ({ state, commit, dispatch }, { pageSelect, vm } = {}) {\n      return new Promise(async resolve => {\n        const pageAim = pageSelect || state.current\n        let currentIndex = 0\n        state.opened.forEach((page, index) => {\n          if (page.name === pageAim) {\n            currentIndex = index\n          }\n        })\n        // 删除打开的页面 并在缓存设置中删除\n        state.opened.splice(currentIndex + 1).forEach(({ name }) => commit('keepAliveRemove', name))\n        // 设置当前的页面\n        state.current = pageAim\n        if (vm && vm.$route.name !== pageAim) {\n          vm.$router.push({\n            name: pageAim\n          })\n        }\n        // 持久化\n        await dispatch('opend2db')\n        // end\n        resolve()\n      })\n    },\n    /**\n     * @class opened\n     * @description 关闭当前激活之外的 tag\n     * @param {Object} state vuex state\n     * @param {Object} param { pageSelect: 当前选中的tagName, vm: vue }\n     */\n    closeOther ({ state, commit, dispatch }, { pageSelect, vm } = {}) {\n      return new Promise(async resolve => {\n        const pageAim = pageSelect || state.current\n        let currentIndex = 0\n        state.opened.forEach((page, index) => {\n          if (page.name === pageAim) {\n            currentIndex = index\n          }\n        })\n        // 删除打开的页面数据 并更新缓存设置\n        if (currentIndex === 0) {\n          state.opened.splice(1).forEach(({ name }) => commit('keepAliveRemove', name))\n        } else {\n          state.opened.splice(currentIndex + 1).forEach(({ name }) => commit('keepAliveRemove', name))\n          state.opened.splice(1, currentIndex - 1).forEach(({ name }) => commit('keepAliveRemove', name))\n        }\n        // 设置新的页面\n        state.current = pageAim\n        if (vm && vm.$route.name !== pageAim) {\n          vm.$router.push({\n            name: pageAim\n          })\n        }\n        // 持久化\n        await dispatch('opend2db')\n        // end\n        resolve()\n      })\n    },\n    /**\n     * @class opened\n     * @description 关闭所有 tag\n     * @param {Object} state vuex state\n     * @param {Object} vm vue\n     */\n    closeAll ({ state, commit, dispatch }, vm) {\n      return new Promise(async resolve => {\n        // 删除打开的页面 并在缓存设置中删除\n        state.opened.splice(1).forEach(({ name }) => commit('keepAliveRemove', name))\n        // 持久化\n        await dispatch('opend2db')\n        // 关闭所有的标签页后需要判断一次现在是不是在首页\n        if (vm.$route.name !== 'index') {\n          vm.$router.push({\n            name: 'index'\n          })\n        }\n        // end\n        resolve()\n      })\n    }\n  },\n  mutations: {\n    /**\n     * @class keepAlive\n     * @description 从已经打开的页面记录中更新需要缓存的页面记录\n     * @param {Object} state vuex state\n     */\n    keepAliveRefresh (state) {\n      state.keepAlive = state.opened.filter(item => {\n        if (item.meta) {\n          if (item.meta.notCache) {\n            return false\n          }\n        }\n        return true\n      }).map(e => e.name)\n    },\n    /**\n     * @description 删除一个页面的缓存设置\n     * @param {Object} state vuex state\n     * @param {String} name name\n     */\n    keepAliveRemove (state, name) {\n      const list = [ ...state.keepAlive ]\n      remove(list, item => item === name)\n      state.keepAlive = list\n    },\n    /**\n     * @description 增加一个页面的缓存设置\n     * @param {Object} state vuex state\n     * @param {String} name name\n     */\n    keepAlivePush (state, name) {\n      const keep = [ ...state.keepAlive ]\n      keep.push(name)\n      state.keepAlive = Array.from(new Set(keep))\n    },\n    /**\n     * @description 清空页面缓存设置\n     * @param {Object} state vuex state\n     */\n    keepAliveClean (state) {\n      state.keepAlive = []\n    },\n    /**\n     * @class current\n     * @description 设置当前激活的页面 name\n     * @param {Object} state vuex state\n     * @param {String} name new name\n     */\n    currentSet (state, name) {\n      state.current = name\n    },\n    /**\n     * @class pool\n     * @description 保存 pool (候选池)\n     * @param {Object} state vuex state\n     * @param {Array} routes routes\n     */\n    init (state, routes) {\n      const pool = []\n      const push = function (routes) {\n        routes.forEach(route => {\n          if (route.children) {\n            push(route.children)\n          } else {\n            if (!route.hidden) {\n              const { meta, name, path } = route\n              pool.push({ meta, name, path })\n            }\n          }\n        })\n      }\n      push(routes)\n      state.pool = pool\n    }\n  }\n}\n"]}]}